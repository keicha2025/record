<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>日日記 | Nichi-Nichi Log (View Only)</title>

    <meta name="theme-color" content="#4A4A4A">
    <!-- No Manifest for View Mode to keep it separate -->

    <!-- iOS 專屬優化 -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="日日記 View">
    <link rel="apple-touch-icon" href="https://cdn-icons-png.flaticon.com/512/2544/2544087.png">

    <!-- 外部資源 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link
        href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500&family=Noto+Sans+JP:wght@300;400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="style.css">
    <style>
        @keyframes spring-up {
            0% {
                transform: translateY(20px) scale(0.9);
                opacity: 0;
            }

            60% {
                transform: translateY(-5px) scale(1.03);
                opacity: 1;
            }

            100% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }

        .animate-spring-up {
            animation: spring-up 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        [v-cloak] {
            display: none;
        }
    </style>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>

<body>
    <div id="app" class="max-w-md mx-auto min-h-screen relative" v-cloak>
        <div v-if="loading" class="fixed inset-0 z-[100] loading-overlay flex flex-col items-center justify-center">
            <div class="w-8 h-8 border-2 border-gray-100 border-t-gray-500 rounded-full animate-spin mb-4"></div>
            <p class="text-[10px] tracking-[0.2em] text-gray-400 uppercase font-light">Loading...</p>
        </div>

        <!-- Header -->
        <app-header :app-mode="appMode" :sync-status="'idle'" :current-tab="currentTab" :history-filter="historyFilter"
            :show-currency-switcher="true"
            @clear-filter="historyFilter = { mode: 'all', categoryId: null, friendName: null, currency: null }">
        </app-header>

        <main class="w-full px-4 pt-4 pb-32">
            <!-- Viewer Dashboard -->
            <view-dashboard v-if="currentTab === 'overview'" :transactions="transactions" :stats="stats"
                :friends="friends" :projects="projects" :config="config" :fx-rate="fxRate"
                :has-multiple-currencies="hasMultipleCurrencies" @switch-tab="currentTab = $event"></view-dashboard>

            <!-- History Page (Reused) -->
            <history-page v-if="currentTab === 'history'" :transactions="filteredTransactions" :categories="categories"
                :payment-methods="paymentMethods" :projects="projects" @edit-item="handleEditItem"
                @update-filter="Object.assign(historyFilter, $event)"></history-page>

            <!-- Edit Page (Reused, Read-Only enforced by appMode) -->
            <edit-page v-if="currentTab === 'edit'" :form="editForm" :categories="categories"
                :payment-methods="paymentMethods" :friends="friends" :projects="projects" :loading="loading"
                :app-mode="appMode" @cancel="currentTab = 'history'; editForm = null;"></edit-page>

            <!-- Stats Page (Reused) -->
            <stats-page v-if="currentTab === 'stats'" :transactions="transactions" :categories="categories"
                :payment-methods="paymentMethods" :fx-rate="fxRate" :projects="projects"
                @drill-down="handleDrillDown"></stats-page>

            <!-- Settings Page (Simplified) -->
            <settings-page v-if="currentTab === 'settings'" :config="config" :friends="friends"
                :transactions="transactions" :projects="projects" :app-mode="appMode" :fx-rate="fxRate"
                @view-friend="handleViewFriend" @view-project="handleViewProject"></settings-page>

            <!-- Project Detail Page -->
            <project-detail-page v-if="currentTab === 'project-detail'" :project="selectedProject"
                :transactions="transactions" @back="currentTab = 'settings'; selectedProject = null"
                @view-history="handleViewHistory">
            </project-detail-page>
        </main>

        <!-- Footer -->
        <viewer-footer v-model:current-tab="currentTab" :app-mode="appMode">
        </viewer-footer>

        <!-- System Modal (Required for Alerts) -->
        <system-modal :visible="modalState.visible" :config="modalState.config" @confirm="handleModalConfirm"
            @cancel="handleModalCancel">
        </system-modal>
    </div>

    <!-- Scripts -->
    <script src="./js/env.js"></script>
    <script type="module" src="./js/view-app.js"></script>
</body>

</html>